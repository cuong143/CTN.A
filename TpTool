local player = game.Players.LocalPlayer
local backpack = player:WaitForChild("Backpack")

-- Xóa tool cũ nếu đã có
local existingTool = backpack:FindFirstChild("TP Tool")
if existingTool then
    existingTool:Destroy()
end

-- Tạo TP Tool mới
local tool = Instance.new("Tool")
tool.Name = "TP Tool"
tool.RequiresHandle = true
tool.ToolTip = ""
tool.CanBeDropped = false
tool.Parent = backpack

-- Tạo tay cầm vô hình
local handle = Instance.new("Part")
handle.Name = "Handle"
handle.Size = Vector3.new(1, 1, 1)
handle.Transparency = 1
handle.CanCollide = false
handle.Anchored = false
handle.Parent = tool

-- Hàm tạo hiệu ứng tốc biến
local function playFlashEffect(position)
    local part = Instance.new("Part")
    part.Size = Vector3.new(1,1,1)
    part.Anchored = true
    part.CanCollide = false
    part.Transparency = 1
    part.CFrame = CFrame.new(position)
    part.Parent = workspace

    local emitter = Instance.new("ParticleEmitter")
    emitter.Texture = "rbxassetid://243660364" -- Khói trắng
    emitter.Lifetime = NumberRange.new(0.3)
    emitter.Rate = 500
    emitter.Speed = NumberRange.new(5)
    emitter.Size = NumberSequence.new({NumberSequenceKeypoint.new(0, 2), NumberSequenceKeypoint.new(1, 0)})
    emitter.Color = ColorSequence.new(Color3.new(1, 1, 1))
    emitter.Transparency = NumberSequence.new(0.2)
    emitter.LightEmission = 1
    emitter.Parent = part

    game.Debris:AddItem(part, 1)
end

-- Âm thanh tốc biến
local function playFlashSound(position)
    local soundPart = Instance.new("Part")
    soundPart.Anchored = true
    soundPart.CanCollide = false
    soundPart.Transparency = 1
    soundPart.CFrame = CFrame.new(position)
    soundPart.Parent = workspace

    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://12222005" -- Whoosh
    sound.Volume = 1
    sound.PlayOnRemove = true
    sound.Parent = soundPart

    sound:Destroy() -- Kích hoạt PlayOnRemove
    game.Debris:AddItem(soundPart, 1)
end

-- Khi kích hoạt tool
tool.Activated:Connect(function()
    local character = player.Character
    if not character then return end

    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local mouse = player:GetMouse()
    local targetPos = mouse.Hit.Position
    local finalPos = targetPos + Vector3.new(0, 3, 0)

    -- Hiệu ứng tại vị trí cũ
    playFlashEffect(hrp.Position)
    playFlashSound(hrp.Position)

    -- Dịch chuyển
    hrp.CFrame = CFrame.new(finalPos)

    -- Hiệu ứng tại vị trí mới
    playFlashEffect(finalPos)
    playFlashSound(finalPos)
end)
