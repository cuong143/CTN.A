-- Tải thư viện Rayfield
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not success then
    warn("Lỗi khi tải Rayfield: " .. tostring(Rayfield))
    return
end

-- Tạo cửa sổ
local Window = Rayfield:CreateWindow({
    Name = "fdsXrin",
    LoadingTitle = "Đang tải GUI...",
    LoadingSubtitle = "by cuong",
    ConfigurationSaving = {
        Enabled = false,
    }
})

-- Tạo tab chính
local Tab = Window:CreateTab("Character")

-- Toggle Infjump
local InfJumpEnabled = false
local JumpConnection

Tab:CreateToggle({
    Name = "Infjump",
    CurrentValue = false,
    Callback = function(Value)
        InfJumpEnabled = Value
        if Value then
            JumpConnection = game:GetService("UserInputService").JumpRequest:Connect(function()
                if InfJumpEnabled and game.Players.LocalPlayer.Character then
                    local Humanoid = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                    if Humanoid then
                        Humanoid:ChangeState("Jumping")
                    end
                end
            end)
        else
            if JumpConnection then
                JumpConnection:Disconnect()
                JumpConnection = nil
            end
        end
    end,
})

-- Slider Speed
local WalkSpeedSlider
WalkSpeedSlider = Tab:CreateSlider({
    Name = "Speed",
    Range = {1, 500},
    Increment = 1,
    Suffix = "WalkSpeed",
    CurrentValue = 16,
    Callback = function(Value)
        local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = Value
        end
    end,
})

-- Nút Reset Speed
Tab:CreateButton({
    Name = "Reset Speed",
    Callback = function()
        local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 16
        end
        WalkSpeedSlider:Set(16)
    end,
})

-- Nút TpTool mới thêm vào
Tab:CreateButton({
    Name = "TpTool",
    Callback = function()
        local success, result = pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/cuong143/CTN.A/refs/heads/main/TpTool"))()
        end)
        if not success then
            warn("Lỗi khi tải TpTool: " .. tostring(result))
        end
    end,
})

-- Toggle NoClip
local NoClipEnabled = false
local NoClipConnection

Tab:CreateToggle({
    Name = "NoClip",
    CurrentValue = false,
    Callback = function(Value)
        NoClipEnabled = Value
        if Value then
            NoClipConnection = game:GetService("RunService").Stepped:Connect(function()
                local character = game.Players.LocalPlayer.Character
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") and part.CanCollide then
                            part.CanCollide = false
                        end
                    end
                end
            end)
        else
            if NoClipConnection then
                NoClipConnection:Disconnect()
                NoClipConnection = nil
            end
            local character = game.Players.LocalPlayer.Character
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
            end
        end
    end,
})

-- Tab hỗ trợ
local SupportTab = Window:CreateTab("Aim")

SupportTab:CreateButton({
    Name = "Aimbot",
    Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cuong143/CTN.A/refs/heads/main/Aim"))()
        end)
        if not success then
            warn("Lỗi khi tải Aimbot: " .. tostring(result))
        end
    end,
})

SupportTab:CreateButton({
    Name = "aimplayer",
    Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cuong143/CTN.A/refs/heads/main/Aimplayer"))()
        end)
        if not success then
            warn("Lỗi khi tải aimplayer: " .. tostring(result))
        end
    end,
})

-- Tab ESP
local ESPTab = Window:CreateTab(" ESP")

local ESPEnabled = false
local ESPConnections = {}

local function removeAllESP()
    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
        if player.Character then
            local char = player.Character
            if char:FindFirstChild("ESP_Box") then
                char.ESP_Box:Destroy()
            end
            if char:FindFirstChild("Head") and char.Head:FindFirstChild("ESP_Name") then
                char.Head.ESP_Name:Destroy()
            end
        end
    end
    for _, conn in pairs(ESPConnections) do
        conn:Disconnect()
    end
    table.clear(ESPConnections)
end

local function createESP(player)
    local Players = game:GetService("Players")
    local RunService = game:GetService("RunService")
    local Camera = workspace.CurrentCamera
    local LocalPlayer = Players.LocalPlayer

    if player == LocalPlayer then return end

    local function updateESP()
        local char = player.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") or not char:FindFirstChild("Head") then return end
        local hrp = char.HumanoidRootPart
        local head = char.Head

        if char:FindFirstChild("ESP_Box") then char.ESP_Box:Destroy() end
        if head:FindFirstChild("ESP_Name") then head.ESP_Name:Destroy() end

        local highlight = Instance.new("Highlight", char)
        highlight.Name = "ESP_Box"
        highlight.FillTransparency = 1
        highlight.OutlineTransparency = 0
        highlight.OutlineColor = Color3.fromRGB(255, 0, 0)

        local billboard = Instance.new("BillboardGui", head)
        billboard.Name = "ESP_Name"
        billboard.Adornee = head
        billboard.AlwaysOnTop = true
        billboard.Size = UDim2.new(5, 0, 1, 0)
        billboard.StudsOffset = Vector3.new(0, 2.5, 0)

        local label = Instance.new("TextLabel", billboard)
        label.Size = UDim2.new(1, 0, 1, 0)
        label.BackgroundTransparency = 1
        label.TextColor3 = Color3.fromRGB(255, 0, 0)
        label.TextStrokeTransparency = 0.5
        label.Text = player.Name
        label.Font = Enum.Font.SourceSansBold
        label.TextScaled = true

        local conn = RunService.RenderStepped:Connect(function()
            if player and player.Character and player.Character:FindFirstChild("Head") then
                local dist = (Camera.CFrame.Position - hrp.Position).Magnitude
                billboard.Size = UDim2.new(math.clamp(10 / dist, 1, 5), 0, math.clamp(2 / dist, 0.5, 2), 0)
            end
        end)
        table.insert(ESPConnections, conn)
    end

    local conn = player.CharacterAdded:Connect(function()
        task.wait(1)
        updateESP()
    end)
    table.insert(ESPConnections, conn)

    if player.Character then
        updateESP()
    end
end

ESPTab:CreateToggle({
    Name = "espplayer",
    CurrentValue = false,
    Callback = function(Value)
        ESPEnabled = Value
        if Value then
            for _, p in pairs(game:GetService("Players"):GetPlayers()) do
                createESP(p)
            end
            local conn = game:GetService("Players").PlayerAdded:Connect(function(p)
                createESP(p)
            end)
            table.insert(ESPConnections, conn)
        else
            removeAllESP()
        end
    end,
})

ESPTab:CreateButton({
    Name = "ESP Monster",
    Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cuong143/CTN.A/refs/heads/main/Espmonter"))()
        end)
        if not success then
            warn("Lỗi khi tải ESP Monster: " .. tostring(result))
        end
    end,
})
